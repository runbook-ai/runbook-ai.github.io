<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Runbook AI</title>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f5f7fa;
      color: #1a1a2e;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 48px 16px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    header h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #1a1a2e;
      letter-spacing: -0.5px;
    }

    header p {
      margin-top: 8px;
      font-size: 1rem;
      color: #6b7280;
      max-width: 560px;
    }

    .card {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 32px;
      width: 100%;
      max-width: 820px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .field {
      margin-bottom: 20px;
    }

    .label {
      display: block;
      font-size: 0.8125rem;
      font-weight: 500;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 6px;
    }

    select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.9375rem;
      color: #374151;
      background: #f9fafb;
      outline: none;
      cursor: pointer;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    select:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
      background: #ffffff;
    }

    textarea {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 0.875rem;
      line-height: 1.65;
      color: #374151;
      background: #f9fafb;
      resize: vertical;
      transition: border-color 0.15s, box-shadow 0.15s;
      outline: none;
    }

    textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
      background: #ffffff;
    }

    #promptArea  { height: 240px; }
    #configArea  { height: 100px; }

    .actions {
      margin-top: 20px;
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
    }

    button#runBtn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 24px;
      background: #6366f1;
      color: #ffffff;
      font-size: 0.9375rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
      white-space: nowrap;
    }

    button#runBtn:hover  { background: #4f46e5; }
    button#runBtn:active { transform: scale(0.97); }
    button#runBtn:disabled {
      background: #a5b4fc;
      cursor: not-allowed;
      transform: none;
    }

    .run-hint {
      font-size: 0.8125rem;
      color: #9ca3af;
      font-style: italic;
    }

    #status              { font-size: 0.875rem; color: #6b7280; }
    #status.success      { color: #059669; }
    #status.error        { color: #dc2626; }

    footer {
      margin-top: 40px;
      font-size: 0.8125rem;
      color: #9ca3af;
      text-align: center;
    }

    footer a { color: #6366f1; text-decoration: none; }
    footer a:hover { text-decoration: underline; }

    .pr-banner {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 14px;
      padding: 8px 18px;
      background: #f6f8fa;
      border: 1px solid #d0d7de;
      border-radius: 20px;
      font-size: 0.875rem;
      color: #24292f;
      text-decoration: none;
      transition: background 0.15s, border-color 0.15s;
    }
    .pr-banner:hover {
      background: #eaeef2;
      border-color: #b0b7be;
      text-decoration: none;
    }
    .pr-banner svg {
      flex-shrink: 0;
    }
    .banner-links {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 14px;
    }
    .banner-links .pr-banner {
      margin-top: 0;
    }
  </style>
</head>
<body>

  <header>
    <h1>Runbook AI</h1>
    <p>Runbooks for the <a href="https://chromewebstore.google.com/detail/runbook-ai/kjbhngehjkiiecaflccjenmoccielojj" target="_blank">Runbook AI Chrome extension</a> — your AI agent for autonomous web tasks.</p>
    <div class="banner-links">
      <a class="pr-banner" href="https://github.com/runbook-ai/runbook-ai.github.io" target="_blank">
        <svg width="18" height="18" viewBox="0 0 16 16" fill="#24292f" aria-hidden="true"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
        Want to share your runbook? Send a PR
      </a>
      <a class="pr-banner" href="https://discord.gg/SDtXkAKK2B" target="_blank">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="#5865F2" aria-hidden="true"><path d="M20.317 4.492c-1.53-.69-3.17-1.2-4.885-1.49a.075.075 0 0 0-.079.036c-.21.369-.444.85-.608 1.23a18.566 18.566 0 0 0-5.487 0 12.36 12.36 0 0 0-.617-1.23A.077.077 0 0 0 8.562 3c-1.714.29-3.354.8-4.885 1.491a.07.07 0 0 0-.032.027C.533 9.093-.32 13.555.099 17.961a.08.08 0 0 0 .031.055 20.03 20.03 0 0 0 5.993 2.98.078.078 0 0 0 .084-.026 13.83 13.83 0 0 0 1.226-1.963.074.074 0 0 0-.041-.104 13.175 13.175 0 0 1-1.872-.878.075.075 0 0 1-.008-.125c.126-.093.252-.19.372-.287a.075.075 0 0 1 .078-.01c3.927 1.764 8.18 1.764 12.061 0a.075.075 0 0 1 .079.009c.12.098.245.195.372.288a.075.075 0 0 1-.006.125c-.598.344-1.22.635-1.873.877a.075.075 0 0 0-.041.105c.36.687.772 1.341 1.225 1.962a.077.077 0 0 0 .084.028 19.963 19.963 0 0 0 6.002-2.981.076.076 0 0 0 .032-.054c.5-5.094-.838-9.52-3.549-13.442a.06.06 0 0 0-.031-.028zM8.02 15.278c-1.182 0-2.157-1.069-2.157-2.38 0-1.312.956-2.38 2.157-2.38 1.21 0 2.176 1.077 2.157 2.38 0 1.312-.956 2.38-2.157 2.38zm7.975 0c-1.183 0-2.157-1.069-2.157-2.38 0-1.312.955-2.38 2.157-2.38 1.21 0 2.176 1.077 2.157 2.38 0 1.312-.946 2.38-2.157 2.38z"/></svg>
        Join Discord
      </a>
    </div>
  </header>

  <div class="card">

    <div class="field">
      <label class="label" for="runbookSelect">Select a Runbook</label>
      <select id="runbookSelect">
        <option value="">-- Choose a runbook --</option>
        <option value="craigslist-car-listings">Find Craigslist Car Listings</option>
      </select>
    </div>

    <div class="field">
      <label class="label" for="promptArea">Prompt</label>
      <textarea id="promptArea" placeholder="Select a runbook above to load its prompt…"></textarea>
    </div>

    <div class="field">
      <label class="label" for="configArea">Config (JSON)</label>
      <textarea id="configArea" placeholder="Select a runbook above to load its config…"></textarea>
    </div>

    <div class="actions">
      <button id="runBtn" disabled>▶ Run</button>
      <span class="run-hint">When clicked, this runbook will be executed by the Runbook AI extension. You can also copy the prompt and paste it into the extension sidepanel input, then press Enter to run.</span>
      <span id="status"></span>
    </div>

  </div>

  <footer>
    Powered by <a href="https://github.com/runbook-ai" target="_blank">Runbook AI</a> &mdash;
    <a href="https://chromewebstore.google.com/detail/runbook-ai/kjbhngehjkiiecaflccjenmoccielojj" target="_blank">Install Chrome Extension</a> &mdash;
    <a href="about/privacy-policy.html">Privacy Policy</a> &mdash;
    <a href="about/terms-of-service.html">Terms of Service</a>
  </footer>

  <script>
    const EXTENSION_ID = "kjbhngehjkiiecaflccjenmoccielojj";

    const runbookSelect = document.getElementById("runbookSelect");
    const promptArea    = document.getElementById("promptArea");
    const configArea    = document.getElementById("configArea");
    const runBtn        = document.getElementById("runBtn");
    const status        = document.getElementById("status");

    runbookSelect.addEventListener("change", async () => {
      const name = runbookSelect.value;
      status.textContent = "";
      status.className = "";

      if (!name) {
        promptArea.value = "";
        configArea.value = "";
        runBtn.disabled = true;
        return;
      }

      try {
        const [mdRes, jsonRes] = await Promise.all([
          fetch(`runbooks/${name}.md`),
          fetch(`runbooks/${name}.json`),
        ]);
        promptArea.value = mdRes.ok   ? await mdRes.text()   : "(Failed to load prompt)";
        configArea.value = jsonRes.ok ? await jsonRes.text() : "{}";
        runBtn.disabled = false;
      } catch (err) {
        console.error(err);
        promptArea.value = "";
        configArea.value = "";
        status.textContent = "Failed to load runbook files.";
        status.className = "error";
        runBtn.disabled = true;
      }
    });

    async function startRunbook(prompt, config) {
      const openResp = await chrome.runtime.sendMessage(EXTENSION_ID, {
        action: "openSidePanel"
      });
      if (openResp?.error) {
        return openResp;
      }
      await new Promise(resolve => setTimeout(resolve, 500));
      const setConfigResp = await chrome.runtime.sendMessage(EXTENSION_ID, {
        action: "setRemoteConfig",
        args: { config }
      });
      if (setConfigResp?.error) {
        return setConfigResp;
      }
      chrome.runtime.sendMessage(EXTENSION_ID, {
        action: "runHeadlessTask",
        args: { prompt }
      });
      return {
        message: "Runbook started successfully."
      }
    }

    runBtn.addEventListener("click", async () => {
      const prompt = promptArea.value.trim();

      if (!prompt) {
        status.textContent = "Prompt is empty.";
        status.className = "error";
        return;
      }

      let config = {};
      try {
        config = JSON.parse(configArea.value || "{}");
      } catch (e) {
        status.textContent = "Config JSON is invalid.";
        status.className = "error";
        return;
      }

      runBtn.disabled = true;
      status.textContent = "Starting runbook…";
      status.className = "";

      try {
        const result = await startRunbook(prompt, config);
        if (result?.error) {
          status.textContent = result.message || result.error;
          status.className = "error";
        } else {
          status.textContent = result?.message ?? "Runbook started successfully.";
          status.className = "success";
        }
      } catch (err) {
        console.error(err);
        status.textContent = "Failed to start runbook. Make sure the Runbook AI extension is installed and enabled.";
        status.className = "error";
      } finally {
        runBtn.disabled = false;
      }
    });

    // Auto-load runbook from URL param ?runbook=...
    const urlRunbook = new URLSearchParams(window.location.search).get("runbook");
    if (urlRunbook) {
      runbookSelect.value = urlRunbook;
      if (runbookSelect.value === urlRunbook) {
        runbookSelect.dispatchEvent(new Event("change"));
      }
    }
  </script>

</body>
</html>
